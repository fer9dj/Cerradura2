<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cerradura de Fer</title>

  <style>
    :root {
      --color-fondo: #050608;
      --color-card: #111319;
      --color-acento: #00ff7f;
      --color-acento-suave: rgba(0, 255, 127, 0.25);
      --color-texto: #f5f5f5;
      --color-error: #ff4b4b;
      --color-bloqueo: #ff6b6b;
    }

    * {
      box-sizing: border-box;
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      background: radial-gradient(circle at top, #1a1f2b 0, #050608 55%);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--color-texto);
    }

    body {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .envoltorio {
      width: 100%;
      height: 100%;
      padding: 16px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .tarjeta {
      width: 100%;
      max-width: 480px;
      background: linear-gradient(145deg, #11151f, #050608);
      border-radius: 24px;
      box-shadow:
        0 0 40px rgba(0, 0, 0, 0.8),
        0 0 18px var(--color-acento-suave);
      padding: 28px 22px 24px;
      display: flex;
      flex-direction: column;
      gap: 24px;
      border: 1px solid rgba(255, 255, 255, 0.07);
    }

    .titulo {
      text-align: center;
      font-size: clamp(26px, 4vw, 32px);
      font-weight: 600;
      margin: 0;
      text-shadow: 0 0 12px var(--color-acento-suave);
    }

    .subtitulo {
      text-align: center;
      margin: 0;
      opacity: 0.8;
      font-size: 16px;
    }

    .display {
      margin: 12px auto 0;
      width: 100%;
      min-height: 58px;
      border-radius: 16px;
      background: rgba(0, 0, 0, 0.35);
      border: 1px solid rgba(255, 255, 255, 0.12);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 8px 12px;
      gap: 4px;
    }

    .dots {
      font-size: 30px;
      letter-spacing: 6px;
      min-height: 34px;
    }

    .estado {
      font-size: 14px;
      opacity: 0.8;
      text-align: center;
      min-height: 18px;
    }

    .estado.error {
      color: var(--color-error);
      opacity: 1;
    }

    .teclado {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 12px;
      margin-top: 8px;
    }

    .tecla {
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.15);
      background: radial-gradient(circle at top, #1b2330 0, #070a10 60%);
      padding: 14px 0;
      font-size: 24px;
      font-weight: 500;
      text-align: center;
      user-select: none;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.7);
      transition: transform 0.08s ease-out, box-shadow 0.08s ease-out, border-color 0.08s ease-out;
    }

    .tecla:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 1px 6px rgba(0, 0, 0, 0.9);
      border-color: var(--color-acento-suave);
    }

    .tecla-funcion {
      font-size: 18px;
    }

    .tecla-accion {
      grid-column: span 3;
      background: linear-gradient(135deg, #00ff7f, #00b36b);
      color: #050608;
      font-weight: 700;
      font-size: 22px;
      letter-spacing: 1px;
      border: none;
      box-shadow:
        0 0 20px rgba(0, 255, 127, 0.5),
        0 6px 14px rgba(0, 0, 0, 0.9);
    }

    .tecla-accion:active {
      transform: translateY(1px) scale(0.98);
      box-shadow:
        0 0 12px rgba(0, 255, 127, 0.55),
        0 2px 10px rgba(0, 0, 0, 1);
    }

    .bloqueo {
      margin-top: 4px;
      text-align: center;
      font-size: 14px;
      color: var(--color-bloqueo);
      opacity: 0;
      transition: opacity 0.15s ease-out;
      min-height: 18px;
    }

    .bloqueo.visible {
      opacity: 1;
    }

    .info-intentos {
      font-size: 13px;
      opacity: 0.7;
      text-align: center;
      margin-top: 4px;
    }

    @media (min-height: 800px) {
      .tarjeta {
        max-width: 520px;
        padding: 32px 26px 26px;
      }
      .dots {
        font-size: 34px;
      }
      .tecla {
        padding: 18px 0;
        font-size: 26px;
      }
      .tecla-funcion {
        font-size: 20px;
      }
      .tecla-accion {
        font-size: 24px;
      }
    }
  </style>
</head>
<body>
  <div class="envoltorio">
    <div class="tarjeta">
      <h1 class="titulo">Bienvenida a la casa de Fer</h1>
      <p class="subtitulo">Ingresa el c√≥digo para accionar la cerradura</p>

      <div class="display">
        <div id="dots" class="dots">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</div>
        <div id="estado" class="estado"></div>
      </div>

      <div class="teclado">
        <div class="tecla" data-num="1">1</div>
        <div class="tecla" data-num="2">2</div>
        <div class="tecla" data-num="3">3</div>

        <div class="tecla" data-num="4">4</div>
        <div class="tecla" data-num="5">5</div>
        <div class="tecla" data-num="6">6</div>

        <div class="tecla" data-num="7">7</div>
        <div class="tecla" data-num="8">8</div>
        <div class="tecla" data-num="9">9</div>

        <div class="tecla tecla-funcion" data-accion="borrar">‚å´</div>
        <div class="tecla" data-num="0">0</div>
        <div class="tecla tecla-funcion" data-accion="limpiar">C</div>

        <div class="tecla tecla-accion" data-accion="abrir">ABRIR</div>
      </div>

      <div id="bloqueo" class="bloqueo">Sistema bloqueado por intentos fallidos</div>
      <div id="intentosInfo" class="info-intentos"></div>
    </div>
  </div>

  <script>
    // üëá CONFIGURACI√ìN B√ÅSICA
    const PIN_CORRECTO = "123456"; // CAMBI√Å ESTO POR TU PIN REAL
    const MAX_INTENTOS = 5;

    // üëá URL DEL TRIGGER (la que me pasaste de Virtual Smart Home)
    const TRIGGER_URL =
      "https://www.virtualsmarthome.xyz/url_routine_trigger/activate.php?trigger=544ff1c4-0289-4c20-8bde-059d42080dd2&token=f7b36347-0d80-49bd-87c0-aa651806ce32&response=smartphone";

    let buffer = "";
    let intentos = 0;
    let bloqueado = false;

    const dotsEl = document.getElementById("dots");
    const estadoEl = document.getElementById("estado");
    const bloqueoEl = document.getElementById("bloqueo");
    const intentosInfoEl = document.getElementById("intentosInfo");

    function actualizarDots() {
      if (buffer.length === 0) {
        dotsEl.textContent = "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢";
        dotsEl.style.opacity = 0.4;
      } else {
        dotsEl.style.opacity = 1;
        dotsEl.textContent = "‚Ä¢".repeat(buffer.length);
      }
    }

    function setEstado(mensaje, tipo = "normal") {
      estadoEl.textContent = mensaje || "";
      estadoEl.classList.toggle("error", tipo === "error");
    }

    function actualizarIntentosInfo() {
      if (bloqueado) {
        intentosInfoEl.textContent = "";
        return;
      }
      const restantes = MAX_INTENTOS - intentos;
      intentosInfoEl.textContent =
        restantes < MAX_INTENTOS
          ? `Intentos restantes: ${restantes}`
          : `Tienes ${MAX_INTENTOS} intentos antes del bloqueo`;
    }

    function bloquearSistema() {
      bloqueado = true;
      bloqueoEl.classList.add("visible");
      setEstado("Demasiados intentos incorrectos", "error");
      buffer = "";
      actualizarDots();
      actualizarIntentosInfo();
    }

    function manejarNumero(num) {
      if (bloqueado) return;
      if (buffer.length >= 10) return; // l√≠mite de longitud de c√≥digo
      buffer += num;
      actualizarDots();
      setEstado("");
    }

    function manejarAccion(accion) {
      if (accion === "borrar") {
        if (bloqueado) return;
        buffer = buffer.slice(0, -1);
        actualizarDots();
        return;
      }

      if (accion === "limpiar") {
        if (bloqueado) return;
        buffer = "";
        actualizarDots();
        setEstado("");
        return;
      }

      if (accion === "abrir") {
        if (bloqueado) {
          setEstado("Sistema bloqueado", "error");
          return;
        }

        if (!buffer.length) {
          setEstado("Ingresa el c√≥digo", "error");
          return;
        }

        if (buffer === PIN_CORRECTO) {
          setEstado("Accionando la cerradura...");
          buffer = "";
          actualizarDots();
          intentos = 0;
          actualizarIntentosInfo();

          // üîî AQU√ç DISPARA EL TRIGGER REAL
          fetch(TRIGGER_URL)
            .then((resp) => {
              // Pod√©s inspeccionar resp si quer√©s
              setEstado("Cerradura accionada");
            })
            .catch((err) => {
              console.error(err);
              setEstado("Error al accionar la cerradura", "error");
            });
        } else {
          intentos++;
          setEstado("C√≥digo incorrecto", "error");
          buffer = "";
          actualizarDots();

          if (intentos >= MAX_INTENTOS) {
            bloquearSistema();
          } else {
            actualizarIntentosInfo();
          }
        }
      }
    }

    // Eventos del teclado visual
    document.querySelectorAll(".tecla").forEach((tecla) => {
      tecla.addEventListener("click", () => {
        const num = tecla.getAttribute("data-num");
        const accion = tecla.getAttribute("data-accion");

        if (num !== null) {
          manejarNumero(num);
        } else if (accion) {
          manejarAccion(accion);
        }
      });
    });

    // Inicializaci√≥n
    actualizarDots();
    actualizarIntentosInfo();
  </script>
</body>
    </html>
